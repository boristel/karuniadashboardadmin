<!DOCTYPE html>
<html>
<head>
    <title>API Endpoint Testing</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
        .json-block { background: #f5f5f5; padding: 10px; border-radius: 3px; white-space: pre-wrap; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .results { margin-top: 10px; }
        .endpoint-info { display: flex; justify-content: space-between; align-items: center; }
        .endpoint-status { font-weight: bold; padding: 4px 8px; border-radius: 3px; color: white; }
        .status-200 { background: #28a745; }
        .status-404 { background: #dc3545; }
        .status-403 { background: #ffc107; color: #000; }
    </style>
</head>
<body>
    <h1>üì° Backend API Endpoint Testing</h1>
    <p>Testing all Strapi endpoints to diagnose issues with master data pages</p>

    <div class="test-section">
        <h2>Quick Test Results</h2>
        <div id="quick-results"></div>
        <button onclick="runAllTests()">üîÑ Run All Tests</button>
    </div>

    <div class="test-section">
        <div class="endpoint-info">
            <h3>1. Categories Endpoint</h3>
            <span id="categories-status" class="endpoint-status">‚è≥ Testing...</span>
        </div>
        <button onclick="testEndpoint('categories', 'http://localhost:1337/api/categories')">Test Categories</button>
        <div id="categories-result" class="results"></div>
    </div>

    <div class="test-section">
        <div class="endpoint-info">
            <h3>2. Vehicle Groups Endpoint</h3>
            <span id="vehicle-groups-status" class="endpoint-status">‚è≥ Testing...</span>
        </div>
        <button onclick="testEndpoint('vehicle-groups', 'http://localhost:1337/api/vehicle-groups')">Test Vehicle Groups</button>
        <div id="vehicle-groups-result" class="results"></div>
    </div>

    <div class="test-section">
        <div class="endpoint-info">
            <h3>3. Vehicle Types Endpoint</h3>
            <span id="vehicle-types-status" class="endpoint-status">‚è≥ Testing...</span>
        </div>
        <button onclick="testEndpoint('vehicle-types', 'http://localhost:1337/api/vehicle-types')">Test Vehicle Types</button>
        <div id="vehicle-types-result" class="results"></div>
    </div>

    <div class="test-section">
        <div class="endpoint-info">
            <h3>4. Colors Endpoint (Requires Auth)</h3>
            <span id="colors-status" class="endpoint-status">‚è≥ Testing...</span>
        </div>
        <button onclick="testEndpoint('colors', 'http://localhost:1337/api/colors')">Test Colors</button>
        <div id="colors-result" class="results"></div>
    </div>

    <div class="test-section">
        <div class="endpoint-info">
            <h3>5. Supervisors Endpoint</h3>
            <span id="supervisors-status" class="endpoint-status">‚è≥ Testing...</span>
        </div>
        <button onclick="testEndpoint('supervisors', 'http://localhost:1337/api/supervisors')">Test Supervisors</button>
        <div id="supervisors-result" class="results"></div>
    </div>

    <div class="test-section">
        <div class="endpoint-info">
            <h3>6. Branches Endpoint</h3>
            <span id="branches-status" class="endpoint-status">‚è≥ Testing...</span>
        </div>
        <button onclick="testEndpoint('branches', 'http://localhost:1337/api/branches')">Test Branches</button>
        <div id="branches-result" class="results"></div>
    </div>

    <script>
        const testResults = {};

        function updateStatus(endpoint, status, message) {
            const statusElement = document.getElementById(`${endpoint}-status`);
            if (status === 200) {
                statusElement.className = 'endpoint-status status-200';
                statusElement.textContent = '‚úÖ 200 OK';
            } else if (status === 404) {
                statusElement.className = 'endpoint-status status-404';
                statusElement.textContent = `‚ùå ${status} Not Found`;
            } else if (status === 403) {
                statusElement.className = 'endpoint-status status-403';
                statusElement.textContent = `üîí ${status} Forbidden`;
            } else {
                statusElement.className = 'endpoint-status status-404';
                statusElement.textContent = `‚ùå ${status} Error`;
            }

            testResults[endpoint] = { status, message };
        }

        async function testEndpoint(name, url) {
            const resultDiv = document.getElementById(`${name}-result`);
            resultDiv.innerHTML = '<p class="info">üîÑ Testing...</p>';

            try {
                const response = await fetch(url);
                const status = response.status;
                const data = await response.json();

                updateStatus(name, status);

                let html = `
                    <div class="${status === 200 ? 'success' : 'error'}">
                        Status: ${status} ${status === 200 ? '‚úÖ' : '‚ùå'}
                    </div>
                `;

                if (data.data && Array.isArray(data.data)) {
                    html += `
                        <div class="info">
                            Data Count: ${data.data.length} items
                        </div>
                        <div class="json-block">Sample Data: ${JSON.stringify(data.data.slice(0, 1), null, 2)}</div>
                    `;
                } else if (data.error) {
                    html += `
                        <div class="error">
                            Error: ${data.error.message}
                        </div>
                        <div class="json-block">Error Details: ${JSON.stringify(data.error, null, 2)}</div>
                    `;
                }

                html += `<div class="json-block">Full Response: ${JSON.stringify(data, null, 2)}</div>`;

                resultDiv.innerHTML = html;
            } catch (error) {
                updateStatus(name, 0);
                resultDiv.innerHTML = `
                    <div class="error">
                        Network Error: ${error.message}
                    </div>
                `;
            }
        }

        async function runAllTests() {
            const endpoints = [
                ['categories', 'http://localhost:1337/api/categories'],
                ['vehicle-groups', 'http://localhost:1337/api/vehicle-groups'],
                ['vehicle-types', 'http://localhost:1337/api/vehicle-types'],
                ['colors', 'http://localhost:1337/api/colors'],
                ['supervisors', 'http://localhost:1337/api/supervisors'],
                ['branches', 'http://localhost:1337/api/branches']
            ];

            for (const [name, url] of endpoints) {
                await testEndpoint(name, url);
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            updateQuickResults();
        }

        function updateQuickResults() {
            const quickResults = document.getElementById('quick-results');
            const workingEndpoints = Object.entries(testResults).filter(([_, result]) => result.status === 200);
            const brokenEndpoints = Object.entries(testResults).filter(([_, result]) => result.status !== 200);

            let html = `
                <div class="success">
                    ‚úÖ Working Endpoints (${workingEndpoints.length}): ${workingEndpoints.map(([name]) => name).join(', ')}
                </div>
            `;

            if (brokenEndpoints.length > 0) {
                html += `
                    <div class="error">
                        ‚ùå Broken Endpoints (${brokenEndpoints.length}): ${brokenEndpoints.map(([name, result]) => `${name} (${result.status})`).join(', ')}
                    </div>
                `;
            }

            quickResults.innerHTML = html;
        }

        // Auto-run tests on page load
        window.onload = () => {
            setTimeout(runAllTests, 500);
        };
    </script>
</body>
</html>